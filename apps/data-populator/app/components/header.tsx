import { useEffect, useState } from 'react'

import { Button } from '@0xintuition/1ui'

import PrivyLogoutButton from '@client/privy-logout-button'
import { Link } from '@remix-run/react'
import { History, Moon, Settings, Sun } from 'lucide-react'
import { ClientOnly } from 'remix-utils/client-only'

export function Header({
  onOpenOptions,
  onOpenHistory,
}: {
  onOpenOptions: () => void
  onOpenHistory: () => void
}) {
  const [theme, setTheme] = useState<'light' | 'dark'>('light')

  useEffect(() => {
    const savedTheme = localStorage.getItem('theme') as 'light' | 'dark' | null
    if (savedTheme) {
      setTheme(savedTheme)
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      setTheme('dark')
    }
  }, [])

  const handleToggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light'
    setTheme(newTheme)
    // toggleTheme()
  }
  return (
    <header className="sticky top-0 z-40 w-full border-b bg-background">
      <div className="container flex h-16 items-center justify-between">
        <Link to="/" className="flex items-center space-x-2">
          <svg viewBox="0 0 874 156" xmlns="http://www.w3.org/2000/svg" height="24px"><path fill="#FF8964" d="M212 35.8h24.72c9.28 0 16.36 2 21.24 6 4.96 4 7.44 9.72 7.44 17.16 0 3.52-.84 6.68-2.52 9.48-1.6 2.72-3.92 4.92-6.96 6.6-3.04 1.6-6.6 2.44-10.68 2.52v-.72c7.52.08 13.36 1.96 17.52 5.64 4.16 3.68 6.24 8.64 6.24 14.88 0 7.44-2.6 13.24-7.8 17.4-5.12 4.16-12.32 6.24-21.6 6.24H212V35.8Zm27.72 74.16c5.52 0 9.72-1.12 12.6-3.36 2.88-2.32 4.32-5.56 4.32-9.72 0-4.32-1.44-7.68-4.32-10.08-2.88-2.4-7.08-3.6-12.6-3.6h-15.96v26.76h15.96Zm-2.76-37.68c5.44 0 9.48-1.08 12.12-3.24 2.64-2.24 3.96-5.4 3.96-9.48 0-4.16-1.32-7.32-3.96-9.48-2.64-2.16-6.68-3.24-12.12-3.24h-13.2v25.44h13.2ZM300.993 122.44c-6.08 0-10.96-2.08-14.64-6.24-3.6-4.24-5.4-10.16-5.4-17.76V57.16h11.52v38.16c0 5.92 1 10.28 3 13.08 2 2.72 5.08 4.08 9.24 4.08 4.64 0 8.28-1.52 10.92-4.56 2.64-3.12 3.96-7.44 3.96-12.96v-37.8h11.52V121h-10.8l-.24-16.68 1.92.72c-1.2 5.52-3.6 9.8-7.2 12.84-3.6 3.04-8.2 4.56-13.8 4.56ZM368.386 57.16h11.52V121h-11.52V57.16Zm-25.32 53.88h58.56V121h-58.56v-9.96Zm1.2-53.88h34.92v9.96h-34.92v-9.96Zm23.28-21.6h12V47.8h-12V35.56ZM439.019 53.68c0-2.48-.72-4.4-2.16-5.76-1.36-1.44-3.28-2.16-5.76-2.16h-14.88V35.8h15.48c6.24 0 10.92 1.6 14.04 4.8 3.2 3.12 4.8 7.76 4.8 13.92V121h-11.52V53.68Zm-25.2 57.36h58.56V121h-58.56v-9.96ZM505.573 122.44c-5.361 0-10.081-1.36-14.16-4.08-4-2.72-7.08-6.6-9.24-11.64-2.08-5.04-3.12-10.92-3.12-17.64 0-6.72 1.04-12.6 3.12-17.64 2.16-5.04 5.24-8.92 9.24-11.64 4.079-2.72 8.799-4.08 14.16-4.08 4.16 0 7.92 1 11.28 3 3.359 1.92 5.88 4.4 7.56 7.44V35.8h11.52V121h-10.56l-.36-9.6c-1.84 3.6-4.44 6.36-7.8 8.28-3.36 1.84-7.24 2.76-11.64 2.76Zm1.68-10.68c3.519 0 6.56-.92 9.12-2.76 2.64-1.84 4.64-4.44 6-7.8 1.36-3.44 2.04-7.48 2.04-12.12 0-4.72-.68-8.76-2.04-12.12-1.36-3.44-3.36-6.04-6-7.8-2.56-1.84-5.68-2.76-9.36-2.76-4.96 0-8.88 2-11.76 6-2.8 4-4.2 9.56-4.2 16.68 0 7.04 1.439 12.6 4.319 16.68 2.881 4 6.84 6 11.881 6ZM550.526 35.8h26.4c5.92 0 11.08 1.08 15.48 3.24 4.48 2.08 7.92 5.12 10.32 9.12 2.48 3.92 3.72 8.56 3.72 13.92 0 5.36-1.24 10.04-3.72 14.04-2.4 3.92-5.84 6.96-10.32 9.12-4.4 2.08-9.56 3.12-15.48 3.12h-14.64V121h-11.76V35.8Zm25.08 41.52c6.16 0 10.76-1.28 13.8-3.84 3.12-2.64 4.68-6.44 4.68-11.4s-1.56-8.72-4.68-11.28c-3.04-2.64-7.64-3.96-13.8-3.96h-13.32v30.48h13.32ZM634.119 57.16h8.76l1.08 16.08-.96-.12c.72-5.36 2.4-9.36 5.04-12 2.72-2.64 6.4-3.96 11.04-3.96h13.56v10.32h-12.96c-3.12 0-5.76.6-7.92 1.8-2.08 1.12-3.64 2.84-4.68 5.16-1.04 2.24-1.56 5.04-1.56 8.4V121h-11.4V57.16Zm-16.2 53.88h47.52V121h-47.52v-9.96Zm0-53.88h22.32v9.96h-22.32v-9.96ZM708.112 122.44c-5.84 0-11-1.36-15.48-4.08-4.4-2.72-7.84-6.6-10.32-11.64-2.4-5.04-3.6-10.92-3.6-17.64 0-6.72 1.2-12.6 3.6-17.64 2.48-5.04 5.92-8.92 10.32-11.64 4.48-2.72 9.64-4.08 15.48-4.08s10.96 1.36 15.36 4.08c4.48 2.72 7.92 6.6 10.32 11.64 2.48 5.04 3.72 10.92 3.72 17.64 0 6.72-1.24 12.6-3.72 17.64-2.4 5.04-5.84 8.92-10.32 11.64-4.4 2.72-9.52 4.08-15.36 4.08Zm0-10.68c5.44 0 9.68-2 12.72-6 3.04-4.08 4.56-9.64 4.56-16.68 0-7.04-1.52-12.56-4.56-16.56-3.04-4.08-7.28-6.12-12.72-6.12s-9.68 2-12.72 6c-3.04 4-4.56 9.56-4.56 16.68 0 7.12 1.52 12.68 4.56 16.68 3.04 4 7.28 6 12.72 6ZM777.665 122.44c-5.84 0-11-1.36-15.48-4.08-4.4-2.72-7.84-6.6-10.32-11.64-2.4-5.04-3.6-10.92-3.6-17.64 0-6.72 1.2-12.6 3.6-17.64 2.48-5.04 5.92-8.92 10.32-11.64 4.48-2.72 9.64-4.08 15.48-4.08s10.96 1.36 15.36 4.08c4.48 2.72 7.92 6.6 10.32 11.64 2.48 5.04 3.72 10.92 3.72 17.64 0 6.72-1.24 12.6-3.72 17.64-2.4 5.04-5.84 8.92-10.32 11.64-4.4 2.72-9.52 4.08-15.36 4.08Zm0-10.68c5.44 0 9.68-2 12.72-6 3.04-4.08 4.56-9.64 4.56-16.68 0-7.04-1.52-12.56-4.56-16.56-3.04-4.08-7.28-6.12-12.72-6.12s-9.68 2-12.72 6c-3.04 4-4.56 9.56-4.56 16.68 0 7.12 1.52 12.68 4.56 16.68 3.04 4 7.28 6 12.72 6ZM832.338 53.8c0-5.92 1.48-10.4 4.44-13.44 2.96-3.04 7.56-4.56 13.8-4.56h18.48v9.96h-18c-2.4 0-4.24.72-5.52 2.16-1.2 1.36-1.8 3.36-1.8 6V121h-11.4V53.8Zm-18.96 3.36h54.72v9.96h-54.72v-9.96Z"></path><rect width="72" height="12" x="56" y="144" fill="#FF8964" rx="6"></rect><rect width="100" height="12" x="56" y="120" fill="#FF8964" rx="6"></rect><rect width="44" height="12" x="112" y="96" fill="#FF8964" rx="6"></rect><rect width="44" height="12" x="56" y="96" fill="#FF8964" rx="6"></rect><rect width="44" height="12" y="144" fill="#E33B3B" rx="6"></rect><rect width="44" height="12" y="120" fill="#E33B3B" rx="6"></rect><rect width="44" height="12" y="96" fill="#E33B3B" rx="6"></rect><rect width="128" height="12" y="72" fill="#E33B3B" rx="6"></rect><rect width="72" height="12" x="84" y="48" fill="#E33B3B" rx="6"></rect><rect width="72" height="12" y="48" fill="#FF8964" rx="6"></rect><rect width="100" height="12" x="56" y="24" fill="#E33B3B" rx="6"></rect><rect width="44" height="12" y="24" fill="#FF8964" rx="6"></rect><rect width="128" height="12" fill="#E33B3B" rx="6"></rect></svg>
        </Link>
        <nav className="flex items-center space-x-4">
          <Button variant="ghost" size="icon" onClick={handleToggleTheme}>
            {theme === 'light' ? (
              <Moon className="h-5 w-5" />
            ) : (
              <Sun className="h-5 w-5" />
            )}
            <span className="sr-only">Toggle theme</span>
          </Button>
          <Button variant="ghost" size="icon" onClick={onOpenHistory}>
            <History className="h-5 w-5" />
            <span className="sr-only">View History</span>
          </Button>
          <Button variant="ghost" size="icon" onClick={onOpenOptions}>
            <Settings className="h-5 w-5" />
            <span className="sr-only">Options</span>
          </Button>
          <ClientOnly>{() => <PrivyLogoutButton />}</ClientOnly>
        </nav>
      </div>
    </header>
  )
}
